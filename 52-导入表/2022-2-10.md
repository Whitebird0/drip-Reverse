导入表结构
---
									
      typedef struct _IMAGE_IMPORT_DESCRIPTOR {										
          union {										
              DWORD   Characteristics;           										
              DWORD   OriginalFirstThunk;         						//RVA 指向IMAGE_THUNK_DATA结构数组				
          };										
          DWORD   TimeDateStamp;               						//时间戳				
          DWORD   ForwarderChain;              										
          DWORD   Name;						//RVA,指向dll名字，该名字以0结尾				
          DWORD   FirstThunk;                 						//RVA,指向IMAGE_THUNK_DATA结构数组				
      } IMAGE_IMPORT_DESCRIPTOR;										
      typedef IMAGE_IMPORT_DESCRIPTOR UNALIGNED *PIMAGE_IMPORT_DESCRIPTOR;										
										
![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20220210215519.png)

PE加载前OriginalFirstThunk和FirstThunk都指向函数名结构体_IMAGE_THUNK_DATA32

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20220210215624.png)

PE加载后OriginalFirstThunk指向函数名结构体，FirstThunk指向函数地址

        typedef struct _IMAGE_THUNK_DATA32 {									
            union {									
                PBYTE  ForwarderString;									
                PDWORD Function;									
                DWORD Ordinal;						//序号			
                PIMAGE_IMPORT_BY_NAME  AddressOfData;						//指向IMAGE_IMPORT_BY_NAME			
            } u1;									
        } IMAGE_THUNK_DATA32;									
        typedef IMAGE_THUNK_DATA32 * PIMAGE_THUNK_DATA32;									
										
IMAGE_THUNK_DATA32是个联合体，当表示函数序号的时候，最高位为1，低31位为序号；当表示函数名的时候，最高位为0，低31位为地址

当表示函数名的时候指向IMAGE_IMPORT_BY_NAME结构体

      typedef struct _IMAGE_IMPORT_BY_NAME {												
          WORD    Hint;						//可能为空，编译器决定 如果不为空 是函数在导出表中的索引						
          BYTE    Name[1];						//函数名称，以0结尾						
      } IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;												
												

