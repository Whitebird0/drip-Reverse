线程安全问题
---

**多线程访问全局变量产生问题的原因：**

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20220218210929.png)

如果线程2在线程1将x修改之前取出x，那么就会发生异常，原本应该是x+1+1，最后变成x=1

**临界区的设计思路：**

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/QQ%E6%88%AA%E5%9B%BE20220218211126.png)

此时当x被线程1占用时，其他线程不能对x进行操作

临界区的使用
---

      1、创建CRITICAL_SECTION：
         CRITICAL_SECTION cs;
      2、在使用前进行初始化
         InitializeCriticalSection(&cs);
      3、在函数中使用:
      	DWORD WINAPI 线程A(PVOID pvParam) 			
	    {			
	      EnterCriticalSection(&cs);							
	      //对全局遍历X的操作							
	      LeaveCriticalSection(&cs);			
	      return(0);			
      	}									
      	DWORD WINAPI 线程B(PVOID pvParam) 			
      	{			
	      EnterCriticalSection(&g_cs);							
	      //对全局遍历X的操作			
	      LeaveCriticalSection(&g_cs);			
	      return(0);			
	      }			
  		4、删除CRITICAL_SECTION
      VOID DeleteCriticalSection(PCRITICAL_SECTION pcs);//当线程不再试图访问共享资源时

CRITICAL_SECTION
---
